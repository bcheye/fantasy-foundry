<!DOCTYPE html>
<html>
<head>
  <title>FantasyFoundry Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='logo.png') }}" alt="FantasyFoundry Logo">
    <h1>FantasyFoundry: FPL Analytics Dashboard</h1>
    <p>Get insights, track top performers, and make data-driven FPL decisions.</p>
  </header>

  <div class="container">
    <form method="get" class="filter-form">
      <label for="position">Position:</label>
      <select name="position" id="position" onchange="this.form.submit()">
        <option value="">All</option>
        {% for p in positions %}
          <option value="{{ p.id }}" {% if selected_position == p.id %}selected{% endif %}>
            {{ p.name }}
          </option>
        {% endfor %}
      </select>

      <label for="team">Team:</label>
      <select name="team" id="team" onchange="this.form.submit()">
        <option value="">All</option>
        {% for t in teams %}
          <option value="{{ t.id }}" {% if selected_team == t.id %}selected{% endif %}>
            {{ t.name }}
          </option>
        {% endfor %}
      </select>
    </form>

    <section>
      <h2>üìà Value Picks: Points vs Cost</h2>
      <canvas id="valueChart"></canvas>
    </section>

    <section>
      <h2>üî• Most Selected Players</h2>
      <canvas id="selectedChart"></canvas>
    </section>

    <section>
      <h2>‚è±Ô∏è Players with Most Minutes Played</h2>
      <canvas id="minutesChart"></canvas>
    </section>
    <section>
      <h2>üí∞ Best Value Players (Points per Cost)</h2>
      <canvas id="valueScoreChart"></canvas>
    </section>
  </div>

  <footer>
    Built with ‚ù§Ô∏è by Brian ¬∑ Powered by Cube.js + Flask
  </footer>

  <script>
    const data = {{ data | tojson }};

    // Points vs Cost
    new Chart(document.getElementById('valueChart').getContext('2d'), {
      type: 'scatter',
      data: {
        datasets: data.points_vs_cost.map(player => ({
          label: player["Players.name"],
          data: [{
            x: parseFloat(player["Players.totalPoints"]),
            y: parseFloat(player["Players.avgCost"])
          }]
        }))
      },
      options: {
        plugins: { title: { display: true, text: 'Total Points vs Cost' } },
        scales: {
          x: { title: { display: true, text: 'Total Points' }},
          y: { title: { display: true, text: 'Cost (Millions)' }}
        }
      }
    });

    new Chart(document.getElementById('selectedChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: data.most_selected.map(p => p["Players.name"]),
        datasets: [{
          label: 'Total Points',
          data: data.most_selected.map(p => p["Players.totalPoints"]),
          backgroundColor: 'rgba(54, 162, 235, 0.6)'
        }]
      }
    });

    new Chart(document.getElementById('minutesChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: data.most_minutes.map(p => p["Players.name"]),
        datasets: [{
          label: 'Minutes',
          data: data.most_minutes.map(p => p["Players.minutes"]),
          backgroundColor: 'rgba(255, 99, 132, 0.6)'
        }]
      }
    });

    new Chart(document.getElementById('valueScoreChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: data.value_score.map(p => p.name),
        datasets: [{
          label: 'Value Score (Points / Cost)',
          data: data.value_score.map(p => p.value),
          backgroundColor: 'rgba(75, 192, 75, 0.6)'
        }]
      },
      options: {
        plugins: { title: { display: true, text: 'Points per Million (Value Score)' } },
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'Value' } }
        }
      }
    });
  </script>
</body>
</html>